<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi City - Phaser 3 Game</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }

        #game-container {
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas {
            border: 4px solid #fff;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .info-overlay {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            z-index: 100;
            max-width: 300px;
        }

        .info-overlay h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #667eea;
        }

        .info-overlay p {
            font-size: 14px;
            line-height: 1.6;
            color: #555;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .controls h2 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #667eea;
        }

        .controls ul {
            list-style: none;
            font-size: 14px;
            color: #555;
        }

        .controls li {
            margin: 5px 0;
        }

        .controls kbd {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .info-overlay,
            .controls {
                display: none;
            }

            canvas {
                border-width: 2px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    
    <div class="info-overlay">
        <h1>üöï Taxi City</h1>
        <p>A Phaser 3 game built with HTML5 Canvas. Pick up passengers and navigate through the city!</p>
    </div>

    <div class="controls">
        <h2>Controls</h2>
        <ul>
            <li><kbd>‚Üê</kbd> <kbd>‚Üí</kbd> <kbd>‚Üë</kbd> <kbd>‚Üì</kbd> Move</li>
            <li><kbd>SPACE</kbd> Pickup/Dropoff</li>
            <li><kbd>R</kbd> Reset Game</li>
        </ul>
    </div>

    <script>
        // Phaser 3 Game Configuration
        const gameConfig = {
            type: Phaser.AUTO,
            parent: 'game-container',
            width: 1024,
            height: 768,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        // Initialize Game
        const game = new Phaser.Game(gameConfig);

        // Global Game Variables
        let player;
        let cursors;
        let passengers = [];
        let score = 0;
        let hasPassenger = false;
        let passengerDestination = null;
        let scoreText;
        let statusText;

        /**
         * Preload Assets
         */
        function preload() {
            // Assets can be loaded here (images, audio, etc.)
            // For now, we'll create graphics programmatically
        }

        /**
         * Create Scene
         */
        function create() {
            // Add background
            this.add.rectangle(512, 384, 1024, 768, 0x87ceeb);

            // Create grid pattern for city streets
            const graphics = this.make.graphics({ x: 0, y: 0, add: false });
            graphics.fillStyle(0xcccccc);
            graphics.lineStyle(2, 0x888888);
            
            for (let i = 0; i < 1024; i += 128) {
                graphics.moveTo(i, 0);
                graphics.lineTo(i, 768);
            }
            for (let i = 0; i < 768; i += 128) {
                graphics.moveTo(0, i);
                graphics.lineTo(1024, i);
            }
            graphics.strokePath();
            graphics.generateTexture('gridTexture', 1024, 768);
            graphics.destroy();

            this.add.image(512, 384, 'gridTexture');

            // Create player (taxi)
            player = this.add.rectangle(512, 384, 40, 60, 0xffff00);
            player.setStroke(0x000000, 3);
            this.physics.add.existing(player);
            player.body.setCollideWorldBounds(true);
            player.body.setBounce(1, 1);

            // Enable cursor controls
            cursors = this.input.keyboard.createCursorKeys();
            this.input.keyboard.on('keydown-SPACE', () => interactWithPassenger(this));
            this.input.keyboard.on('keydown-R', () => resetGame(this));

            // Create initial passengers
            createPassengers(this, 3);

            // Add UI text
            scoreText = this.add.text(16, 16, 'Score: 0', {
                fontSize: '32px',
                fill: '#000000',
                backgroundColor: '#ffffff',
                padding: { x: 10, y: 5 },
                borderRadius: 5
            }).setScrollFactor(0);

            statusText = this.add.text(16, 60, 'Status: Searching for passengers', {
                fontSize: '16px',
                fill: '#000000',
                backgroundColor: '#ffffff',
                padding: { x: 10, y: 5 },
                borderRadius: 5
            }).setScrollFactor(0);
        }

        /**
         * Update Game Loop
         */
        function update() {
            // Player movement
            player.body.setVelocity(0);

            if (cursors.left.isDown) {
                player.body.setVelocityX(-300);
            }
            if (cursors.right.isDown) {
                player.body.setVelocityX(300);
            }
            if (cursors.up.isDown) {
                player.body.setVelocityY(-300);
            }
            if (cursors.down.isDown) {
                player.body.setVelocityY(300);
            }

            // Update status text
            updateStatusText();

            // Check proximity to passengers
            checkPassengerProximity();
        }

        /**
         * Create Passengers on the Map
         */
        function createPassengers(scene, count) {
            passengers = [];
            for (let i = 0; i < count; i++) {
                const x = Phaser.Math.Between(100, 924);
                const y = Phaser.Math.Between(100, 668);
                
                const passenger = scene.add.rectangle(x, y, 30, 30, 0xff0000);
                passenger.setStroke(0x000000, 2);
                scene.physics.add.existing(passenger);
                
                passenger.picked = false;
                passenger.destination = {
                    x: Phaser.Math.Between(100, 924),
                    y: Phaser.Math.Between(100, 668)
                };
                
                passengers.push(passenger);
            }
        }

        /**
         * Check Proximity to Passengers
         */
        function checkPassengerProximity() {
            passengers.forEach(passenger => {
                if (!passenger.picked) {
                    const distance = Phaser.Math.Distance.Between(
                        player.x, player.y,
                        passenger.x, passenger.y
                    );
                    
                    if (distance < 50) {
                        passenger.setFillStyle(0xff6600);
                    } else {
                        passenger.setFillStyle(0xff0000);
                    }
                }
            });
        }

        /**
         * Interact with Passenger
         */
        function interactWithPassenger(scene) {
            if (!hasPassenger) {
                // Try to pick up a passenger
                for (let i = 0; i < passengers.length; i++) {
                    const passenger = passengers[i];
                    const distance = Phaser.Math.Distance.Between(
                        player.x, player.y,
                        passenger.x, passenger.y
                    );

                    if (distance < 50 && !passenger.picked) {
                        hasPassenger = true;
                        passenger.picked = true;
                        passengerDestination = passenger.destination;
                        passenger.setFillStyle(0x00ff00);
                        passenger.x = player.x;
                        passenger.y = player.y;
                        break;
                    }
                }
            } else {
                // Drop off passenger at destination
                const distance = Phaser.Math.Distance.Between(
                    player.x, player.y,
                    passengerDestination.x, passengerDestination.y
                );

                if (distance < 80) {
                    // Find the picked-up passenger and place at destination
                    for (let i = 0; i < passengers.length; i++) {
                        if (passengers[i].picked) {
                            passengers[i].x = passengerDestination.x;
                            passengers[i].y = passengerDestination.y;
                            passengers[i].picked = false;
                            passengers[i].setFillStyle(0xff0000);
                            break;
                        }
                    }
                    hasPassenger = false;
                    passengerDestination = null;
                    score += 100;
                    scoreText.setText('Score: ' + score);
                }
            }
        }

        /**
         * Update Status Text
         */
        function updateStatusText() {
            if (hasPassenger) {
                const distance = Phaser.Math.Distance.Between(
                    player.x, player.y,
                    passengerDestination.x, passengerDestination.y
                );
                statusText.setText(`Status: Drive to destination (${Math.round(distance)}px away)`);
            } else {
                statusText.setText('Status: Searching for passengers');
            }
        }

        /**
         * Reset Game
         */
        function resetGame(scene) {
            score = 0;
            hasPassenger = false;
            passengerDestination = null;
            player.x = 512;
            player.y = 384;
            player.body.setVelocity(0);
            scoreText.setText('Score: 0');
            createPassengers(scene, 3);
        }
    </script>
</body>
</html>